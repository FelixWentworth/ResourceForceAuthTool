{"version":3,"sources":["modules/story/services/story-storage-service.factory.js"],"names":["angular","module","factory","$http","$q","service","storiesPromise","storiesMetadataPromise","getStories","defer","get","then","story","resolve","data","promise","getStory","id","getById","getStoriesMetadata","stories","metadatas","forEach","push","s","save","post","getNewStoryId"],"mappings":";;AAAAA,QACEC,MADF,CACS,OADT,EAEEC,OAFF,CAEU,qBAFV,EAEiC,CAAC,OAAD,EAAU,IAAV,EAAgB,UAASC,KAAT,EAAgBC,EAAhB,EAAoB;AACnE,KAAIC,UAAU,EAAd;;AAEA;AACA,KAAIC,iBAAiB,IAArB;AACA,KAAIC,yBAAyB,IAA7B;;AAEA;AACA,UAASC,UAAT,GAAsB;AACrB;AACAF,mBAAiBF,GAAGK,KAAH,EAAjB;;AAEAN,QAAMO,GAAN,CAAU,WAAW,QAArB,EACEC,IADF,CACO,UAASC,KAAT,EAAe;AACpBN,kBAAeO,OAAf,CAAuBD,MAAME,IAA7B;AACA,GAHF;;AAKA,SAAOR,eAAeS,OAAtB;AACA;;AAED,UAASC,QAAT,CAAkBC,EAAlB,EAAsB;AACrB;AACAX,mBAAiBF,GAAGK,KAAH,EAAjB;;AAEAN,QAAMO,GAAN,CAAU,WAAW,SAAX,GAAuBO,EAAjC,EACEN,IADF,CACO,UAASC,KAAT,EAAe;AACpBN,kBAAeO,OAAf,CAAuBD,MAAME,IAA7B;AACA,GAHF;;AAKA,SAAOR,eAAeS,OAAtB;AACA;;AAED;AACAV,SAAQa,OAAR,GAAkB,UAASD,EAAT,EAAa;AAC9B,SAAOD,SAASC,EAAT,EACLN,IADK,CACA,UAASC,KAAT,EAAe;AACpB,OAAGA,SAAS,IAAZ,EAAkB;AACjB,WAAOA,KAAP;AACA;;AAED,SAAM,iCAAiCK,EAAvC;AACA,GAPK,CAAP;AAQA,EATD;;AAWAZ,SAAQc,kBAAR,GAA6B,YAAY;AACxC;AACAZ,2BAAyBH,GAAGK,KAAH,EAAzB;;AAEAD,eACEG,IADF,CACO,UAASS,OAAT,EAAkB;AACvB,OAAIC,YAAY,EAAhB;;AAEAD,WAAQE,OAAR,CAAgB,aAAK;AACpBD,cAAUE,IAAV,CAAeC,CAAf;AACA,IAFD;;AAIAjB,0BAAuBM,OAAvB,CAA+BQ,SAA/B;AACA,GATF;;AAWA,SAAOd,uBAAuBQ,OAA9B;AACA,EAhBD;;AAkBAV,SAAQoB,IAAR,GAAe,UAAUb,KAAV,EAAiB;AAC/B,SAAOT,MAAMuB,IAAN,CAAW,WAAW,QAAtB,EAAgCd,KAAhC,CAAP;AACA,EAFD;;AAIAP,SAAQsB,aAAR,GAAwB,YAAW;AAClC,SAAO,mBAAP;AACA,EAFD;;AAIA,QAAOtB,OAAP;AACA,CAvE+B,CAFjC","file":"story-storage-service.factory.js","sourcesContent":["angular\r\n\t.module(\"story\")\r\n\t.factory(\"StoryStorageService\", [\"$http\", \"$q\", function($http, $q) {\r\n\t\tvar service = {};\r\n\r\n\t\t// private variables\r\n\t\tvar storiesPromise = null;\r\n\t\tvar storiesMetadataPromise = null;\r\n\r\n\t\t// private methods\r\n\t\tfunction getStories() {\r\n\t\t\t// get new data every time\r\n\t\t\tstoriesPromise = $q.defer();\t\t\r\n\t\t\t\r\n\t\t\t$http.get('../api' + '/story')\r\n\t\t\t\t.then(function(story){\r\n\t\t\t\t\tstoriesPromise.resolve(story.data);\t\t\r\n\t\t\t\t});\r\n\r\n\t\t\treturn storiesPromise.promise;\r\n\t\t}\r\n\r\n\t\tfunction getStory(id) {\r\n\t\t\t// get new data every time\r\n\t\t\tstoriesPromise = $q.defer();\t\t\r\n\t\t\t\r\n\t\t\t$http.get('../api' + '/story/' + id)\r\n\t\t\t\t.then(function(story){\r\n\t\t\t\t\tstoriesPromise.resolve(story.data);\t\t\r\n\t\t\t\t});\r\n\r\n\t\t\treturn storiesPromise.promise;\r\n\t\t}\r\n\r\n\t\t// public methods\r\n\t\tservice.getById = function(id) {\r\n\t\t\treturn getStory(id)\r\n\t\t\t\t.then(function(story){\r\n\t\t\t\t\tif(story != null) {\r\n\t\t\t\t\t\treturn story;\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\tthrow \"Couldn't find story for id: \" + id;\r\n\t\t\t\t});\r\n\t\t};\t\t\r\n\r\n\t\tservice.getStoriesMetadata = function () {\r\n\t\t\t// get new data every time\r\n\t\t\tstoriesMetadataPromise = $q.defer();\r\n\r\n\t\t\tgetStories()\r\n\t\t\t\t.then(function(stories) {\r\n\t\t\t\t\tvar metadatas = [];\r\n\r\n\t\t\t\t\tstories.forEach(s => {\r\n\t\t\t\t\t\tmetadatas.push(s)\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tstoriesMetadataPromise.resolve(metadatas);\r\n\t\t\t\t});\r\n\r\n\t\t\treturn storiesMetadataPromise.promise;\r\n\t\t};\r\n\r\n\t\tservice.save = function (story) {\r\n\t\t\treturn $http.post('../api' + '/story', story);\r\n\t\t};\r\n\t\t\r\n\t\tservice.getNewStoryId = function() {\r\n\t\t\treturn \"temp-new-story-id\";\r\n\t\t};\r\n\r\n\t\treturn service;\r\n\t}]);"]}