{"version":3,"sources":["modules/story/services/story-editor-service.factory.js"],"names":["angular","module","factory","service","setStory","story","pruneRemovedCharacters","getCharacters","content","characters","createNarratorSubscene","subscene","Subscene","action","Narrator","addCharacterReactions","createCharacterSubscene","character","speechCharacter","Character","name","elements","push","Speech","createChoice","choice","Choice","scene","createEnd","End","forEach","emotion","_type","c","Array","singleOrNull","reactions","reaction","element","Emotion","value"],"mappings":";;AAAAA,QACEC,MADF,CACS,OADT,EAEEC,OAFF,CAEU,oBAFV,EAEgC,YAAW;AACzC,KAAIC,UAAU,EAAd;;AAEA;AACAA,SAAQC,QAAR,GAAmB,UAAUC,KAAV,EAAiB;AACnCF,UAAQE,KAAR,GAAgBA,KAAhB;AACA,EAFD;;AAIAF,SAAQG,sBAAR,GAAiC,YAAY;AAC5C;AACH;;;;;;;;;;;;;;;;;;;AAmBG,EArBD;;AAuBAH,SAAQI,aAAR,GAAwB,YAAW;AAClC,SAAOJ,QAAQE,KAAR,CAAcG,OAAd,CAAsBC,UAA7B;AACA,EAFD;;AAIAN,SAAQO,sBAAR,GAAiC,YAAY;AAC5C,MAAIC,WAAW,IAAIC,QAAJ,EAAf;AACAD,WAASE,MAAT,GAAkB,IAAIC,QAAJ,EAAlB;;AAEAC,wBAAsBJ,QAAtB;;AAEA,SAAOA,QAAP;AACA,EAPD;;AASAR,SAAQa,uBAAR,GAAkC,UAAUC,SAAV,EAAqB;AACtD,MAAIN,WAAW,IAAIC,QAAJ,EAAf;;AAEA,MAAIM,kBAAkB,IAAIC,SAAJ,CAAcF,UAAUG,IAAxB,CAAtB;AACAT,WAASE,MAAT,GAAkBK,eAAlB;;AAEAH,wBAAsBJ,QAAtB;;AAEAO,kBAAgBG,QAAhB,CAAyBC,IAAzB,CAA8B,IAAIC,MAAJ,EAA9B;;AAEA,SAAOZ,QAAP;AACA,EAXD;;AAaAR,SAAQqB,YAAR,GAAuB,UAAUJ,IAAV,EAAgB;AACtC,MAAIK,SAAS,IAAIC,MAAJ,EAAb;AACAD,SAAOE,KAAP,CAAaP,IAAb,GAAoBA,IAApB;;AAEAL,wBAAsBU,OAAOZ,MAA7B;;AAEA,SAAOY,MAAP;AACA,EAPD;;AASAtB,SAAQyB,SAAR,GAAoB,YAAY;AAC/B,SAAO,IAAIC,GAAJ,EAAP;AACA,EAFD;;AAIA;AACA,UAASd,qBAAT,CAA+BJ,QAA/B,EAAyC;AACxCR,UAAQI,aAAR,GAAwBuB,OAAxB,CAAgC,aAAK;;AAEpC,OAAIC,UAAU,IAAd;AACA,OAAId,YAAY,IAAhB;;AAEA,OAAGN,SAASE,MAAT,CAAgBmB,KAAhB,IAAyB,WAAzB,IAAwCrB,SAASE,MAAT,CAAgBO,IAAhB,IAAwBa,EAAEb,IAArE,EAA2E;AAC1EH,gBAAYN,SAASE,MAArB;AACA,IAFD,MAEO;AACNI,gBAAYiB,MAAMC,YAAN,CAAmBxB,SAASyB,SAA5B,EAAuC;AAAA,YAAYC,SAASL,KAAT,IAAkB,WAAlB,IAAiCK,SAASjB,IAAT,IAAiBa,EAAEb,IAAhE;AAAA,KAAvC,CAAZ;AACA;;AAED,OAAGH,aAAa,IAAhB,EAAsB;AACrBc,cAAUG,MAAMC,YAAN,CAAmBlB,UAAUI,QAA7B,EAAuC;AAAA,YAAWiB,QAAQN,KAAR,IAAiB,SAA5B;AAAA,KAAvC,CAAV;AACA,IAFD,MAEO;AACN,QAAIf,YAAY,IAAIE,SAAJ,CAAcc,EAAEb,IAAhB,CAAhB;AACAT,aAASyB,SAAT,CAAmBd,IAAnB,CAAwBL,SAAxB;AACA;;AAED,OAAGc,WAAW,IAAd,EAAoB;AACnBA,cAAU,IAAIQ,OAAJ,EAAV;AACAtB,cAAUI,QAAV,CAAmBC,IAAnB,CAAwBS,OAAxB;AACA;;AAEDA,WAAQS,KAAR,GAAgB,MAAhB;AACA,GAxBD;AAyBA;;AAED,QAAOrC,OAAP;AACA,CAtGF","file":"story-editor-service.factory.js","sourcesContent":["angular\r\n\t.module(\"story\")\r\n\t.factory(\"StoryEditorService\", function() {\r\n\t\tvar service = {};\r\n\r\n\t\t// public methods\r\n\t\tservice.setStory = function (story) {\r\n\t\t\tservice.story = story;\r\n\t\t};\t\t\r\n\r\n\t\tservice.pruneRemovedCharacters = function () {\r\n\t\t\t// prune characters\r\n/*\r\n\t\t\tvar checkScenes = service.story.content.scene;\r\n\r\n\t\t\twhile(checkScenes.length > 0) {\r\n\t\t\t\tvar checkScene = checkScenes.splice(0, 1);\r\n\r\n\t\t\t\tcheckScene.elements.forEach(element => {\r\n\r\n\t\t\t\t\tif(element._type == \"Subscene\") {\r\n\t\t\t\t\t\tif() {\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if(element._type == \"Choice\") {\r\n\t\t\t\t\t\tcheckElements = checkElements.concat(element.action);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t};*/\r\n\t\t};\r\n\r\n\t\tservice.getCharacters = function() {\r\n\t\t\treturn service.story.content.characters;\r\n\t\t};\r\n\r\n\t\tservice.createNarratorSubscene = function () {\r\n\t\t\tvar subscene = new Subscene();\r\n\t\t\tsubscene.action = new Narrator();\r\n\t\t\t\r\n\t\t\taddCharacterReactions(subscene);\r\n\r\n\t\t\treturn subscene;\r\n\t\t};\r\n\r\n\t\tservice.createCharacterSubscene = function (character) {\r\n\t\t\tvar subscene = new Subscene();\r\n\r\n\t\t\tvar speechCharacter = new Character(character.name);\r\n\t\t\tsubscene.action = speechCharacter;\r\n\r\n\t\t\taddCharacterReactions(subscene);\r\n\r\n\t\t\tspeechCharacter.elements.push(new Speech());\r\n\r\n\t\t\treturn subscene;\t\t\t\r\n\t\t};\r\n\r\n\t\tservice.createChoice = function (name) {\r\n\t\t\tvar choice = new Choice();\r\n\t\t\tchoice.scene.name = name;\r\n\r\n\t\t\taddCharacterReactions(choice.action);\t\t\t\r\n\t\t\t\r\n\t\t\treturn choice;\r\n\t\t};\r\n\r\n\t\tservice.createEnd = function () {\r\n\t\t\treturn new End();\r\n\t\t};\r\n\r\n\t\t// private methods\r\n\t\tfunction addCharacterReactions(subscene) {\r\n\t\t\tservice.getCharacters().forEach(c => {\r\n\r\n\t\t\t\tvar emotion = null;\r\n\t\t\t\tvar character = null;\r\n\r\n\t\t\t\tif(subscene.action._type == \"Character\" && subscene.action.name == c.name) {\r\n\t\t\t\t\tcharacter = subscene.action;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcharacter = Array.singleOrNull(subscene.reactions, reaction => reaction._type == \"Character\" && reaction.name == c.name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(character != null) {\r\n\t\t\t\t\temotion = Array.singleOrNull(character.elements, element => element._type == \"Emotion\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar character = new Character(c.name);\t\t\t\t\t\r\n\t\t\t\t\tsubscene.reactions.push(character);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(emotion == null) {\r\n\t\t\t\t\temotion = new Emotion();\r\n\t\t\t\t\tcharacter.elements.push(emotion)\r\n\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\temotion.value = \"none\";\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn service;\r\n\t});"]}