{"version":3,"sources":["modules/story/components/tree-editor/scene/story-tree-scene-editor.component.js"],"names":["angular","module","component","templateUrl","bindings","scene","onClicked","controller","StoryEditorService","ctrl","isThisSceneLevelComplete","removeElement","element","Array","remove","elements","checkValidity","doesntContain","types","containsWhereType","i","containsWhere","e","_type","addNarrator","narratorSubscene","createNarratorSubscene","push","openAddCharacterMenu","$mdMenu","event","characters","length","alert","open","addCharacter","character","characterSubscene","createCharacterSubscene","addChoice","choiceCount","forEach","choiceName","name","choice","createChoice","addEnd","end","createEnd","$onInit","label","getCharacters","$postLink","form","$setValidity"],"mappings":"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","file":"story-tree-scene-editor.component.js","sourcesContent":["angular\r\n\t.module(\"story\")\r\n\t.component(\"storyTreeSceneEditor\", {\r\n\t\ttemplateUrl: \"modules/story/components/tree-editor/scene/story-tree-scene-editor.html\",\r\n\t\tbindings: {\r\n\t\t\tscene: \"=\",\r\n\t\t\tonClicked: \"=\"\r\n\t\t},\r\n\t\tcontroller: [\"StoryEditorService\", function(StoryEditorService) {\r\n\t\t\tvar ctrl = this;\r\n\r\n\t\t\t// public variables\r\n\t\t\tctrl.isThisSceneLevelComplete = false;\r\n\r\n\t\t\t// public methods\r\n\t\t\tctrl.removeElement = function(element) {\r\n\t\t\t\tArray.remove(ctrl.scene.elements, element);\r\n\t\t\t\tcheckValidity();\r\n\t\t\t};\r\n\r\n\t\t\tctrl.doesntContain = function(types) {\r\n\t\t\t\tvar containsWhereType = false;\r\n\t\t\t\tfor(var i in types) {\r\n\t\t\t\t\tif(Array.containsWhere(ctrl.scene.elements, e => e._type == types[i])) {\r\n\t\t\t\t\t\tcontainsWhereType = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn !containsWhereType;\r\n\t\t\t}\r\n\r\n\t\t\tctrl.addNarrator = function () {\t\r\n\t\t\t\tvar narratorSubscene = StoryEditorService.createNarratorSubscene();\r\n\t\t\t\tctrl.scene.elements.push(narratorSubscene);\r\n\r\n\t\t\t\t// todo remove\r\n\t\t\t\tcheckValidity();\r\n\t\t\t};\r\n\r\n\r\n\t\t\tctrl.openAddCharacterMenu = function ($mdMenu, event) {\r\n\t\t\t\tif(ctrl.characters.length == 0) {\r\n\t\t\t\t\talert(\"You need to have at least 2 characters in your story.\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t$mdMenu.open(event);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tctrl.addCharacter = function (character) {\r\n\t\t\t\tvar characterSubscene = StoryEditorService.createCharacterSubscene(character);\r\n\t\t\t\tctrl.scene.elements.push(characterSubscene);\r\n\t\t\t};\r\n\r\n\t\t\tctrl.addChoice = function () {\r\n\t\t\t\tvar choiceCount = 0;\r\n\t\t\t\tctrl.scene.elements.forEach(e => choiceCount += e._type == \"Choice\" ? 1 : 0);\r\n\r\n\t\t\t\tvar choiceName = ctrl.scene.name + \".\" + (choiceCount + 1);\r\n\r\n\t\t\t\tvar choice = StoryEditorService.createChoice(choiceName);\r\n\t\t\t\tctrl.scene.elements.push(choice);\r\n\r\n\t\t\t\tcheckValidity();\r\n\t\t\t};\r\n\r\n\t\t\tctrl.addEnd = function () {\r\n\t\t\t\tvar end = StoryEditorService.createEnd();\r\n\t\t\t\tctrl.scene.elements.push(end);\r\n\r\n\t\t\t\tcheckValidity();\r\n\t\t\t};\r\n\r\n\t\t\tctrl.$onInit = function () {\r\n\t\t\t\tif(ctrl.scene._type == \"Choice\") {\r\n\t\t\t\t\tctrl.choice = ctrl.scene;\r\n\t\t\t\t\tctrl.scene = ctrl.choice.scene;\r\n\t\t\t\t\t// todo make data driven\r\n\t\t\t\t\tctrl.label = \"Choice\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.label = \"Scene\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctrl.characters = StoryEditorService.getCharacters();\r\n\t\t\t};\r\n\r\n\t\t\tctrl.$postLink = function () {\r\n\t\t\t\tcheckValidity();\r\n\t\t\t};\r\n\r\n\t\t\t// private methods\r\n\t\t\tfunction checkValidity() {\t\t\t\t\r\n\t\t\t\tctrl.isThisSceneLevelComplete = Array.containsWhere(ctrl.scene.elements, e => e._type == \"End\" || e._type == \"Choice\" );\r\n\t\t\t\tctrl.form.$setValidity(\"incomplete\", ctrl.isThisSceneLevelComplete);\r\n\t\t\t}\r\n\t\t}]\r\n\t});"]}